{"code":"!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=0)}([function(e,t,n){const o=n(1);window.addEventListener(\"load\",()=>{new o});const i=document.getElementById(\"modal-tris\"),c=document.getElementById(\"modal-quar\");document.getElementById(\"cancel-exit\").addEventListener(\"click\",()=>{i.style.display=\"none\"}),document.getElementById(\"cancel-next\").addEventListener(\"click\",()=>{c.style.display=\"none\"}),document.getElementById(\"nextBtn\").addEventListener(\"click\",()=>{c.classList.add(\"is-active\")}),document.getElementById(\"exitBtn\").addEventListener(\"click\",()=>{i.classList.add(\"is-active\")})},function(e,t,n){const{startup:o,stopStreaming:i}=n(2),c=n(3);e.exports=class{constructor(){this.socket=io.connect(),this.init()}init(){const e=document.getElementById(\"mainPage\"),t=document.getElementById(\"landingPage\"),n=document.getElementById(\"overlayBtn\"),s=document.getElementById(\"info\"),l=document.getElementById(\"notification\"),d=document.getElementById(\"inputText\"),a=document.getElementById(\"next\"),r=document.getElementById(\"exit\"),m=document.getElementById(\"simpleNavbar\"),u=document.getElementById(\"modal\"),g=document.getElementById(\"cameraBtn\"),y=document.getElementById(\"modal-bis\"),v=document.getElementById(\"modal-bis-close-btn\"),f=document.getElementById(\"photo\"),p=document.getElementById(\"timer\");let E,h=this;function I(){clearInterval(E),p.textContent=\"\"}function k(e,t){\"danger\"===t&&(d.disabled=!0,l.classList.add(\"is-danger\"));document.querySelector(\"#notification div\").textContent=e,l.style.display=\"block\"}function B(e){var t=d.value;0!=t.trim().length&&(isNaN(Number(e.keyCode))||13===e.keyCode)&&(d.value=\"\",h.socket.emit(\"postMsg\",{msg:t,typing:!1}),h._displayNewMsg(\"me\",{msg:t},\"right\"))}this.socket.on(\"connect\",()=>{document.getElementById(\"name\").focus(),localStorage.removeItem(\"socketId\"),localStorage.removeItem(\"nickname\")}),this.socket.on(\"disconnect\",e=>{\"io server disconnect\"===e&&this.socket.connect(),console.log(\"socket disconnected\")}),this.socket.on(\"reconnect\",()=>{console.log(\"reconnected.\"),l.style.display=\"none\",l.classList.remove(\"is-danger\");document.querySelector(\"#notification div\").textContent=\"\"}),this.socket.on(\"reconnecting\",()=>{k(\"Reconnecting...\",\"info\"),console.log(\"Reconnecting... to server\")}),this.socket.once(\"connect_error\",(function(){console.log(\"connect error\"),k(\"No internet connection.\",\"danger\")})),this.socket.on(\"loginSuccess\",()=>{\"block\"==s.style.display&&(s.style.display=\"none\"),n.classList.add(\"is-loading\"),u.classList.add(\"is-active\")}),this.socket.on(\"gotAPair\",(o,i)=>{l.style.display=\"none\",[u,n].forEach(e=>{e.classList.remove(\"is-active\")}),e.style.display=\"block\",m.style.display=\"flex\",t.style.display=\"none\";document.getElementById(\"subtitle\").textContent=o,document.getElementById(\"otherUser\").textContent=i,d.disabled=!1,clearInterval(E),document.getElementById(\"timer\").textContent=\"\",E=c((function(){h.socket.emit(\"timer expired\")})).ref,localStorage.setItem(\"socketId\",this.socket.id),localStorage.setItem(\"nickname\",o)}),this.socket.on(\"partnerLeft\",o=>{I(),function(o){\"block\"==l.style.display&&(l.style.display=\"none\");if(e.style.display=\"none\",h._removeChild(document.querySelector(\"#msgContainer .columns .column\")),t.style.display=\"block\",m.style.display=\"none\",n.classList.remove(\"is-loading\"),n.textContent=\"Start\",\"none\"===s.style.display){const e=`<span class=\"span\">${o}</span>`;s.innerHTML=e,s.style.display=\"block\"}}(o)}),this.socket.on(\"notification\",(e,t)=>{I(),k(e,t)}),this.socket.on(\"system\",(function(e){document.getElementById(\"onlineCount\").textContent=\"User Online: \"+e})),this.socket.on(\"newMsg\",(function(e,t){h._displayNewMsg(e,t,\"left\")})),a.addEventListener(\"click\",()=>{document.getElementById(\"modal-quar\").classList.remove(\"is-active\"),h.socket.emit(\"findAnotherPair\"),u.classList.add(\"is-active\"),I(),h._removeChild(document.querySelector(\"#msgContainer .columns .column\"))}),r.addEventListener(\"click\",()=>{document.getElementById(\"modal-tris\").classList.remove(\"is-active\"),h.socket.emit(\"getMeOut\")}),document.getElementById(\"overlayBtn\").addEventListener(\"click\",()=>{var e=document.getElementById(\"name\").value;0!=e.trim().length?h.socket.emit(\"login\",e):document.getElementById(\"name\").focus()},!1),document.getElementById(\"close_btn\").addEventListener(\"click\",()=>{l.style.display=\"none\"}),document.getElementById(\"name\").addEventListener(\"keyup\",(function(e){if(isNaN(Number(e.keyCode))||13===e.keyCode){var t=document.getElementById(\"name\").value;0!=t.trim().length&&h.socket.emit(\"login\",t)}}),!1),document.getElementById(\"btnSend\").addEventListener(\"click\",B,!1),d.addEventListener(\"keyup\",B,!1),d.addEventListener(\"input\",()=>{h.socket.emit(\"postMsg\",{msg:\"\",typing:!0})}),g.addEventListener(\"click\",()=>{alert(\"not implemented yet\"),o()}),v.addEventListener(\"click\",()=>{y.classList.remove(\"is-active\"),f.setAttribute(\"src\",\"\"),i()}),document.getElementById(\"imageBtn\").addEventListener(\"click\",()=>{\"\"!==f.src&&(h.socket.emit(\"postMsg\",{msg:\"\",img:f.src,typing:!1}),h._displayNewMsg(\"me\",{msg:\"\",img:f.src,typing:!1}),v.click())},!1)}_removeChild(e){[].slice.call(e.children).forEach(t=>{e.removeChild(t)})}_displayNewMsg(e,t,n){const o=document.querySelector(\"#msgContainer .columns .column\");let i=document.createElement(\"div\");if(\"left\"===n){if([\"field\",\"has-text-left\"].forEach(e=>i.classList.add(e)),t.typing);else{if(\"img\"in t){const e=new Image;e.onload=function(){c(`<img src=${e.src}>`)},e.src=t.img}else c(t.msg);o.appendChild(i)}}else{if([\"field\",\"has-text-right\"].forEach(e=>i.classList.add(e)),\"img\"in t){const e=new Image;e.onload=function(){c(`<img src=${e.src}>`)},e.src=t.img}else c(t.msg);o.appendChild(i)}function c(e){i.innerHTML=`<div class=\"control custom\"><span class=\"msg has-background-white\">${e}</span></div>`}}}},function(e,t){var n,o=0,i=!1,c=null,s=null,l=null,d=null;function a(){var e=s.getContext(\"2d\");e.fillStyle=\"#AAA\",e.fillRect(0,0,s.width,s.height);var t=s.toDataURL(\"image/png\");l.setAttribute(\"src\",t)}function r(){i&&n.getTracks().forEach(e=>{e.stop()})}e.exports={startup:function(){c=document.getElementById(\"video\"),s=document.getElementById(\"canvas\"),l=document.getElementById(\"photo\"),d=document.getElementById(\"startbutton\");var e={video:{deviceId:\"deviceId\"},audio:!1};function t(t){const n=document.querySelector(\"select#availableCameras\");n.innerHTML=\"\",t.map(e=>{const t=document.createElement(\"option\");return t.label=e.label,t.value=e.deviceId,t.textContent=\"\"!=e.label?e.label:e.deviceId,t}).forEach(e=>n.add(e)),n.addEventListener(\"change\",t=>{r(),e.video.deviceId=t.target.value,u()})}async function m(e){return(await navigator.mediaDevices.enumerateDevices()).filter(t=>t.kind===e)}function u(){navigator.mediaDevices.getUserMedia(e).then((function(e){n=e,c.srcObject=e,c.play()})).catch((function(e){console.log(\"An error occurred: \"+e)}))}m(\"videoinput\").then(e=>{t(e)}),navigator.mediaDevices.addEventListener(\"devicechange\",async()=>{t(await m(\"videoinput\"))}),u(),c.addEventListener(\"canplay\",(function(e){i||(o=c.videoHeight/(c.videoWidth/320),isNaN(o)&&(o=240),c.setAttribute(\"width\",320),c.setAttribute(\"height\",o),s.setAttribute(\"width\",320),s.setAttribute(\"height\",o),i=!0)}),!1),d.addEventListener(\"click\",(function(e){!function(){var e=s.getContext(\"2d\");if(o){s.width=320,s.height=o,e.drawImage(c,0,0,320,o);var t=s.toDataURL(\"image/png\");l.setAttribute(\"src\",t)}else a()}(),e.preventDefault()}),!1),a()},stopStreaming:r}},function(e,t){e.exports=function(e){var t=(new Date).getTime()+12e5,n=setInterval((function(){var o=(new Date).getTime(),i=t-o,c=Math.floor(i%36e5/6e4),s=Math.floor(i%6e4/1e3);document.getElementById(\"timer\").innerHTML=c+\"m \"+s+\"s \",i<0&&(clearInterval(n),e())}),1e3);return{ref:n}}}]);","extractedComments":[]}